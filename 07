import time
import random

mlist = []                                                                  #основний список з даними

luggage = []                                                                #список вільних ячейок в камері схову
boxes = int(input("Введіть кількість наявних ячейок камери схову: "))       #кількість ячейок, які фізично є на станції
j = 1                                                                       #допоміжна змінна, щоб заповнити список ячейок

while j <= boxes:                                                           #цей цикл заповнює список ячейок, з якого беруться номера для пасажирів
    luggage.append(j)
    j = j + 1

while True:                                                                 #робить роботу програми безкінечною.
    b = (input("Пасажир бажає здати чи взяти багаж? GIVE/TAKE "))           #питаємо, хоче він здати чи отримати багаж
    if b == 'GIVE' and len(luggage) > 0:                                    #хоче здати. Є вільні ячейки
        name = (input("Введіть прізвище: "))                                #вводимо його прізвище
        if len(name) > 20:                                                  #умова з ТЗ, що прізвище не може бути довшим за 20 знаків
            print("ERROR. The name is too long")
            continue
        a = time.localtime()
        mlist.append(name)                                                  #додаємо прізвище пасажира до основного списку
        start = time.strftime("%H:%M")                                      #визначаємо час, коли отримано доступ до ячейки
        mlist.append(start)                                                 #додаємо час доступу до ячейки до основного списку
        box = luggage.pop(random.randrange(0, len(luggage)))                #призначаємо пасажиру номер шафки, та видаляємо його зі списку вільних ячейок, щоб ненароком не дати доступ ще й іншому клієнту
        mlist.append(box)                                                   #додаємо номер ячейки до основного списку
        print("Пасажир ", name, "отримав доступ до ячейки ", box, " в ", start)     #виводимо інформацію про клієнта та його номер ячейки
        print("Кількість вільних ячейок: ", len(luggage))                           #актуальна інформація про кількість наявних вільних ячейок
        print(" ")

    elif b == 'GIVE' and len(luggage) <= 0:                                         #комунікат на випадок, якщо вільних ячейок немає
        print("Клієнт мусить почекати, поки з'явиться вільна ячейка")
        print("")

    elif b == 'TAKE':                                                                                               #пасажир хоче здати багаж
        lookfor = (input("Введіть прізвище пасажира, який хоче забрати багаж: "))                                   #перемінна-прізвище пасажира, по якому шукаємо його дані в основному списку
        ind = mlist.index(lookfor)                                                                                  #визначаємо індекс прізвища в списку
        finish = time.strftime("%H:%M")                                                                             #визначаємо час, коли пасажир забирає багаж
        mlist.insert((ind + 3), finish)                                                                             #записуємо час видачі багажу до основного списку
        print("Пасажир ", mlist[ind], " користувався ячейкою ", mlist[ind + 2], " з ", mlist[ind + 1], " по ",
              mlist[ind + 3])                                                                                       #інформація про користування ячейкою. Індекси потрібних даних витягую з простого списку,
                                                                                                                    #оскільки всі вони додані там у визначеному порядку
        luggage.append(mlist[ind + 2])                                                                              #повертаю номер звільненої ячейки до списку ячейок, звідки її можна присвоювати новим пасажирам
        print("Кількість вільних ячейок: ", len(luggage))                                                           #актуальна інформація про кількість вільних ячейок
        print(" ")

    else:
        print("Error")                                                                                              #обробка виключення, щоб програма не припиняла працювати
